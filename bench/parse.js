/**
 * Modules dependencies
 */

var Parser = require('./../lib/parser');

/**
 * Benchmark
 */

var NOF_BYTES = Math.pow(10,7); // 10M
var sample = getSample();
var length = new Buffer(sample).length;

while(true){
	var runs = 0;
	var start = new Date();
	var parser = createParser();
	for(var i = 0; i < NOF_BYTES; i += length){
		parser.parse(sample);
		runs++;
	}
	parser.end();
	var end = new Date();

	var timeSpent = end - start;
	var totalBytes = length * runs;
	console.log(timeSpent + ' ms');
	console.log(totalBytes/timeSpent + ' bytes/ms');
}

/**
 * Helpers
 */

function createParser(){
	var options = {
		delimiter : '\t'
	}
	var parser = new Parser(options);
	return parser;
}

function getSample(){
	var sample = 'nom;num_station;nb_bornettes;En_service;M_en_S_16_nov_07;street;Mot_Directeur;No;Nrivoli;commune;code_insee;X_CC43;Y_CC43;X_WGS84;Y_WGS84\nMONUMENT AUX COMBATTANTS;23;24;O;O;BD LAZARE CARNOT;CARNOT (BD LAZARE CARNOT);6;3105555132;Toulouse;31555;1575029,804;2267951,232;1,45208030;43,60130697\nQUAI DE TOUNIS;27;22;O;O;QU DE TOUNIS;TOUNIS (QU DE TOUNIS);122B;3105558520;Toulouse;31555;1574082,159;2267717,421;1,44039892;43,59904509\nLAFAYETTE;2;22;O;O;RUE LAFAYETTE;LAFAYETTE (RUE LAFAYETTE);21;3105554920;Toulouse;31555;1574488,513;2268358,298;1,44528393;43,60488031\nPLACE SAINT ETIENNE;24;20;O;O;PL SAINT ETIENNE;ETIENNE (PL SAINT ETIENNE);14;3105557756;Toulouse;31555;1574804,298;2267818,812;1,44931802;43,60007786\nPLACE ROUAIX;25;17;O;O;RUE DES TOURNEURS;TOURNEURS (RUE DES TOURNEURS);1;3105558536;Toulouse;31555;1574492,721;2267762,874;1,44547250;43,59952263\nCAPTAINERIE PORT  - ST SAUVEUR;101;20;O;N;PORT SAINT SAUVEUR;SAUVEUR (PORT SAINT SAUVEUR);5;3105558066;Toulouse;31555;1575323,606;2267202,395;1,45588907;43,59461663\nPLACE DE LA DAURADE;11;28;O;O;PL DE LA DAURADE;DAURADE (PL DE LA DAURADE);2;3105552520;Toulouse;31555;1574024,363;2267959,896;1,43962745;43,60121754\nPLACE DUPUY;43;22;O;O;PL DOMINIQUE MARTIN DUPUY;DUPUY (PL DOMINIQUE MARTIN DUPUY);14;3105552828;Toulouse;31555;1575246,286;2267821,583;1,45479064;43,60017610\nDAURIAC - ESCANDE;42;23;O;O;BD PR LEOPOLD ESCANDE;ESCANDE (BD PR LEOPOLD ESCANDE);3;3105557151;Toulouse;31555;1575353,450;2267981,274;1,45608134;43,60163093\nPOMME;3;19;O;O;RUE DE LA POMME;POMME (RUE DE LA POMME);62;3105556988;Toulouse;31555;1574503,296;2268179,048;1,44550808;43,60326965\nCARNOT - LABEDA;21;22;O;O;BD LAZARE CARNOT;CARNOT (BD LAZARE CARNOT);63;3105555132;Toulouse;31555;1574879,960;2268262,036;1,45015369;43,60407912\nVERDIER - GRAND ROND;65;27;O;O;ALL FORAIN FRANCOIS VERDIER;VERDIER (ALL FORAIN FRANCOIS VERDIER);2;3105553396;Toulouse;31555;1575067,000;2267455,571;1,45265399;43,59685254\nJARDIN ROYAL;66;23;O;O;RUE DU HUIT MAI 1945;MAI 1945 (RUE DU HUIT MAI 1945);0;3105554272;Toulouse;31555;1574926,877;2267414,210;1,45092834;43,59645708\nFEUGA;69;20;O;O;ALL PAUL FEUGA;FEUGA (ALL PAUL FEUGA);11;3105556620;Toulouse;31555;1574290,879;2267004,129;1,44314721;43,59266083\n';
	return sample;
}
